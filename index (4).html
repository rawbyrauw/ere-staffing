<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>eRe Staffing – Guided Quote Builder (v2)</title>
  <meta name="description" content="Build instant quotations with presets, currency selection, and branded PDF output."/>
  <style>
    :root{--navy:#1F2D3A;--slate:#3E4C59;--light:#F4F6F8;--accent:#20344A;--white:#ffffff;}
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Apple Color Emoji','Segoe UI Emoji';color:var(--navy);background:var(--light);line-height:1.6;}
    a{color:inherit;text-decoration:none} img{max-width:100%;display:block}
    .container{max-width:1100px;margin:0 auto;padding:0 1.25rem}
    .section{padding:3.5rem 0} .grid{display:grid;gap:1.25rem}
    header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,0.85);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid rgba(31,45,58,0.08);}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:0.75rem 0}
    .logo{display:flex;align-items:center;gap:.6rem}
    .logo-mark{width:36px;height:36px;border-radius:10px;background:#fff;display:grid;place-items:center;color:#fff;box-shadow:0 8px 18px rgba(32,52,74,.25);flex-shrink:0;overflow:hidden}
    .logo-mark img{width:100%;height:100%;object-fit:contain;border-radius:10px;background:#fff}
    .brand{font-weight:700;letter-spacing:.2px}
    nav ul{display:flex;gap:1rem;list-style:none;margin:0;padding:0} nav a{padding:.5rem .75rem;border-radius:12px} nav a:hover{background:rgba(32,52,74,.08)}
    .cta{background:var(--accent);color:var(--white);padding:.8rem 1rem;border:none;border-radius:14px;font-weight:600;cursor:pointer}
    .cta.secondary{background:#fff;color:var(--accent);border:1px solid rgba(31,45,58,.2)}
    .cta:hover{filter:brightness(1.08)}
    .hero{padding:5rem 0;background:linear-gradient(180deg,#fff,rgba(244,246,248,.7))}
    .hero-wrap{display:grid;gap:1.3rem;align-items:center} .kicker{color:var(--slate);font-size:.95rem;letter-spacing:.4px}
    h1{font-size:clamp(1.9rem,3.8vw,3rem);margin:.25rem 0 .5rem} .sub{color:var(--slate);font-size:1.1rem;max-width:48ch}
    .hero-card{background:#fff;border-radius:18px;padding:1.1rem 1rem;box-shadow:0 14px 30px rgba(31,45,58,.12);display:flex;flex-wrap:wrap;gap:.6rem;align-items:center}
    .trust{display:flex;align-items:center;gap:.6rem;background:var(--light);padding:.55rem .7rem;border-radius:12px} .trust svg{width:18px;height:18px;color:var(--accent)}
    .form-card{background:#fff;border-radius:18px;padding:1.25rem 1.25rem;box-shadow:0 12px 26px rgba(31,45,58,.1);}
    .form-grid{display:grid;gap:1rem;grid-template-columns:1fr 1fr}
    .field{display:grid;gap:.35rem}
    label{font-weight:600;color:var(--navy)}
    input,textarea,select{padding:.8rem;border:1px solid rgba(31,45,58,.15);border-radius:12px;background:#fff;font:inherit}
    textarea{min-height:100px;resize:vertical}
    .role-card{border:1px solid rgba(31,45,58,.12);border-radius:14px;padding:.9rem;margin-top:.6rem}
    .muted{color:#6b7b8c;font-size:.95rem}
    .hidden{display:none}
    footer{padding:2.25rem 0;color:#d9e1e8;background:var(--accent);margin-top:3rem} .footer-grid{display:grid;gap:1rem;grid-template-columns:1fr auto} .footer-logo .logo-mark{box-shadow:none}
    .footnote{color:#b9c6d3;font-size:.95rem}
    @media (max-width: 900px){.form-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a href="#top" class="logo" aria-label="eRe Staffing home">
        <span class="logo-mark"><img src="logo.png" alt="eRe Staffing logo" /></span>
        <span class="brand">eRe Staffing</span>
      </a>
      <nav aria-label="Primary">
        <ul>
          <li><a href="#contact">Quote</a></li>
        </ul>
      </nav>
      <a id="headerCta" class="cta" href="#contact">Build a Quote</a>
    </div>
  </header>

  <section class="hero" id="top">
    <div class="container hero-wrap">
      <span class="kicker">Local, responsive, and safety‑minded</span>
      <h1>Guided Quotation for Temporary Staffing</h1>
      <p class="sub">Choose options that match your operation. If something doesn’t fit, select “Other” and enter a custom value.</p>
      <div class="hero-card">
        <button id="heroCta" class="cta" type="button">Build a Quote</button>
        <div class="trust" title="Pre-screened local workforce">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>Pre‑screened local workforce</span>
        </div>
        <div class="trust" title="Compliance via Employer of Record">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 1l9 4v6c0 5-3.8 9.7-9 11-5.2-1.3-9-6-9-11V5l9-4z" stroke="currentColor" stroke-width="2" fill="none"/><path d="M8 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>Compliance handled via Employer of Record</span>
        </div>
      </div>
    </div>
  </section>

  <!-- QUOTE FORM -->
  <section id="contact" class="section">
    <div class="container">
      <div class="form-card">
        <form id="quoteForm" aria-label="Guided quote builder form">
          <h2 style="margin-top:0">Build your quote</h2>
          <p class="muted">On submit, a branded PDF quotation will download and an email draft will open with the same details.</p>

          <div class="form-grid">
            <div class="field"><label for="name">Primary Contact</label><input id="name" name="name" required /></div>
            <div class="field"><label for="company">Company</label><input id="company" name="company" required /></div>
          </div>

          <div class="form-grid">
            <div class="field"><label for="email">Work Email</label><input id="email" name="email" type="email" required /></div>
            <div class="field"><label for="phone">Phone / WhatsApp</label><input id="phone" name="phone" /></div>
          </div>

          <div class="field"><label for="address">Site Address</label><input id="address" name="address" placeholder="Street, City, State" /></div>

          <div class="form-grid">
            <div class="field">
              <label for="currency">Currency</label>
              <select id="currency" name="currency">
                <option value="USD" selected>USD ($)</option>
                <option value="EUR">EUR (€)</option>
              </select>
            </div>
            <div class="field">
              <label for="weeks">Duration</label>
              <select id="weeks" name="weeks">
                <option value="4">4 weeks</option>
                <option value="8">8 weeks</option>
                <option value="12">12 weeks</option>
                <option value="other">Other</option>
              </select>
              <input id="weeks_other" name="weeks_other" type="number" min="1" placeholder="Enter weeks" class="hidden" />
            </div>
          </div>

          <div class="form-grid">
            <div class="field"><label for="discountPct">Discount % (optional)</label><input id="discountPct" name="discountPct" type="number" step="0.01" placeholder="e.g., 5" /></div>
            <div class="field">
              <label for="preset">Preset bundle (optional)</label>
              <select id="preset" name="preset">
                <option value="">— Choose a preset —</option>
                <option value="2pick1lift_2nd">2 Pickers + 1 Forklift (2nd shift)</option>
                <option value="3prod_1qc">3 Production + 1 Quality Control</option>
                <option value="4pack_peak">4 Picker/Packer (peak support)</option>
              </select>
            </div>
          </div>

          <div class="form-grid">
            <div class="field"><label for="otThreshold">OT threshold (hrs/week)</label>
              <select id="otThreshold" name="otThreshold">
                <option value="40">40</option>
                <option value="45">45</option>
                <option value="50">50</option>
                <option value="other">Other</option>
              </select>
              <input id="otThreshold_other" name="otThreshold_other" type="number" min="0" placeholder="e.g., 42" class="hidden" />
            </div>
            <div class="field"><label for="otMult">OT multiplier</label>
              <select id="otMult" name="otMult">
                <option value="1.5">1.5x</option>
                <option value="1.75">1.75x</option>
                <option value="2">2.0x</option>
                <option value="other">Other</option>
              </select>
              <input id="otMult_other" name="otMult_other" type="number" min="1" step="0.01" placeholder="e.g., 1.6" class="hidden" />
            </div>
          </div>

          <div class="form-grid">
            <div class="field"><label for="wkndPremPct">Weekend premium % (optional)</label>
              <select id="wkndPremPct" name="wkndPremPct">
                <option value="0">None</option>
                <option value="5">+5%</option>
                <option value="10">+10%</option>
                <option value="15">+15%</option>
                <option value="other">Other</option>
              </select>
              <input id="wkndPremPct_other" name="wkndPremPct_other" type="number" step="0.01" placeholder="Custom %" class="hidden" />
            </div>
            <div class="field"><label for="wkndHours">Weekend hours per worker/week</label>
              <select id="wkndHours" name="wkndHours">
                <option value="0">0</option>
                <option value="4">4</option>
                <option value="8">8</option>
                <option value="12">12</option>
                <option value="other">Other</option>
              </select>
              <input id="wkndHours_other" name="wkndHours_other" type="number" step="0.1" placeholder="Custom hours" class="hidden" />
            </div>
          </div>

          <hr style="border:none;border-top:1px solid #e6ebf1;margin:.5rem 0 0.75rem" />
          <div class="muted">Add up to 5 roles. Choose from presets or select “Other”.</div>

          <div id="rolesWrap"></div>
          <button id="addRole" class="cta secondary" type="button" style="width:max-content">+ Add role</button>

          <div class="field" style="margin-top:1rem">
            <label for="notes">Other notes</label>
            <textarea id="notes" name="notes" placeholder="Anything else we should know"></textarea>
          </div>

          <button class="cta" type="submit">Generate Quotation PDF & Email</button>
          <p id="formNotice" class="muted"></p>
        </form>
      </div>
    </div>
  </section>

  <footer>
    <div class="container footer-grid">
      <div class="footer-logo logo"><span class="logo-mark"><img src="logo.png" alt="eRe Staffing logo" /></span><span class="brand" style="color:#fff">eRe Staffing</span></div>
      <div class="footnote">
        <div>Pre‑screened local workforce · Compliance handled via Employer of Record</div>
        <div style="margin-top:.3rem">© <span id="year"></span> eRe Staffing · Raúl Alejandro Ocaña Estrada · <a style="color:#e8f0f7" href="mailto:erestaffing@gmail.com">erestaffing@gmail.com</a> · <a style="color:#e8f0f7" href="https://wa.me/4915774010314" target="_blank" rel="noopener">WhatsApp: +49 1577 4010314</a></div>
      </div>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => [...root.querySelectorAll(sel)];
    const show = (el) => el.classList.remove('hidden');
    const hide = (el) => el.classList.add('hidden');
    const getNum = (v, d=0) => { const n = parseFloat(v); return isNaN(n) ? d : n; };
    const fmt = (n, cur) => `${cur==='EUR' ? '€' : '$'}${Number(n).toFixed(2)}`;

    // Smooth scroll + year
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener('click',e=>{
        const href=a.getAttribute('href'); if(href.length>1){ e.preventDefault(); document.querySelector(href).scrollIntoView({behavior:'smooth'}); }
      })
    });
    $('#year').textContent = new Date().getFullYear();
    $('#heroCta').addEventListener('click', ()=> $('#contact').scrollIntoView({behavior:'smooth'}));
    $('#headerCta').addEventListener('click', (e)=>{e.preventDefault(); $('#contact').scrollIntoView({behavior:'smooth'});});

    // Toggle "Other" fields for selects
    function attachOther(selectId, otherId){
      const sel = $(selectId), other = $(otherId);
      const sync = ()=> sel.value === 'other' ? show(other) : (other.value='', hide(other));
      sel.addEventListener('change', sync); sync();
    }
    attachOther('#weeks', '#weeks_other');
    attachOther('#otThreshold', '#otThreshold_other');
    attachOther('#otMult', '#otMult_other');
    attachOther('#wkndPremPct', '#wkndPremPct_other');
    attachOther('#wkndHours', '#wkndHours_other');

    // Role template with guided choices
    const rolesWrap = $('#rolesWrap');
    let roleCount = 0;
    function roleTemplate(i){
      return `
      <fieldset class="role-card" data-role="${i}">
        <legend><strong>Role ${i}</strong></legend>

        <div class="form-grid">
          <div class="field">
            <label>Role</label>
            <select name="r${i}_roleSel">
              <option value="">Choose a role…</option>
              <option>Picker/Packer</option>
              <option>Forklift Operator</option>
              <option>Production Worker</option>
              <option>Quality Control</option>
              <option value="Other">Other</option>
            </select>
            <input name="r${i}_roleOther" placeholder="If other, type here" class="hidden">
          </div>
          <div class="field">
            <label>Qty</label>
            <select name="r${i}_qty">
              ${[...Array(21)].map((_,n)=>`<option value="${n}">${n}</option>`).join('')}
            </select>
          </div>
        </div>

        <div class="form-grid">
          <div class="field">
            <label>Hours/Day</label>
            <select name="r${i}_hpdSel">
              <option value="8">8</option>
              <option value="10">10</option>
              <option value="12">12</option>
              <option value="other">Other</option>
            </select>
            <input name="r${i}_hpdOther" type="number" min="0" placeholder="Custom hours" class="hidden">
          </div>
          <div class="field">
            <label>Days/Week</label>
            <select name="r${i}_dpwSel">
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="other">Other</option>
            </select>
            <input name="r${i}_dpwOther" type="number" min="0" max="7" placeholder="Custom days" class="hidden">
          </div>
        </div>

        <div class="form-grid">
          <div class="field">
            <label>Pricing mode</label>
            <select name="r${i}_mode">
              <option value="bill">Bill rate (simple)</option>
              <option value="markup">Pay rate + markup %</option>
            </select>
          </div>
          <div class="field">
            <label>Bill $/hr (if bill mode)</label>
            <input name="r${i}_bill" type="number" step="0.01" placeholder="e.g., 24">
          </div>
        </div>

        <div class="form-grid">
          <div class="field">
            <label>Pay $/hr (if markup mode)</label>
            <input name="r${i}_pay" type="number" step="0.01" placeholder="e.g., 18">
          </div>
          <div class="field">
            <label>Markup % (if markup mode)</label>
            <select name="r${i}_markupSel">
              <option value="25">25%</option>
              <option value="30">30%</option>
              <option value="35" selected>35%</option>
              <option value="40">40%</option>
              <option value="other">Other</option>
            </select>
            <input name="r${i}_markupOther" type="number" step="0.01" placeholder="Custom %" class="hidden">
          </div>
        </div>

        <div class="form-grid">
          <div class="field">
            <label>One-time Fees (optional)</label>
            <select name="r${i}_feesSel">
              <option value="0">$0</option>
              <option value="50">$50</option>
              <option value="100">$100</option>
              <option value="200">$200</option>
              <option value="other">Other</option>
            </select>
            <input name="r${i}_feesOther" type="number" step="0.01" placeholder="Custom $" class="hidden">
          </div>
          <div class="field" style="display:flex;align-items:flex-end;justify-content:flex-end">
            <button type="button" class="cta secondary" onclick="this.closest('fieldset').remove()">Remove</button>
          </div>
        </div>
      </fieldset>`;
    }

    function attachRoleToggles(fs){
      const roleSel = $('select[name$="_roleSel"]', fs);
      const roleOther = $('input[name$="_roleOther"]', fs);
      const hpdSel = $('select[name$="_hpdSel"]', fs);
      const hpdOther = $('input[name$="_hpdOther"]', fs);
      const dpwSel = $('select[name$="_dpwSel"]', fs);
      const dpwOther = $('input[name$="_dpwOther"]', fs);
      const markupSel = $('select[name$="_markupSel"]', fs);
      const markupOther = $('input[name$="_markupOther"]', fs);
      const feesSel = $('select[name$="_feesSel"]', fs);
      const feesOther = $('input[name$="_feesOther"]', fs);

      function sync(){ roleSel.value==='Other' ? show(roleOther) : (roleOther.value='', hide(roleOther)); }
      function syncH(){ hpdSel.value==='other' ? show(hpdOther) : (hpdOther.value='', hide(hpdOther)); }
      function syncD(){ dpwSel.value==='other' ? show(dpwOther) : (dpwOther.value='', hide(dpwOther)); }
      function syncM(){ markupSel.value==='other' ? show(markupOther) : (markupOther.value='', hide(markupOther)); }
      function syncF(){ feesSel.value==='other' ? show(feesOther) : (feesOther.value='', hide(feesOther)); }

      roleSel.addEventListener('change', sync); sync();
      hpdSel.addEventListener('change', syncH); syncH();
      dpwSel.addEventListener('change', syncD); syncD();
      markupSel.addEventListener('change', syncM); syncM();
      feesSel.addEventListener('change', syncF); syncF();
    }

    function addRole(){
      if(roleCount>=5) return;
      roleCount++;
      rolesWrap.insertAdjacentHTML('beforeend', roleTemplate(roleCount));
      attachRoleToggles(rolesWrap.lastElementChild);
      $('select[name$="_qty"]', rolesWrap.lastElementChild).value = '2';
      $('input[name$="_bill"]', rolesWrap.lastElementChild).value = '24';
    }

    $('#addRole').addEventListener('click', addRole);
    addRole(); addRole();

    // Apply preset bundles
    const preset = $('#preset');
    preset.addEventListener('change', ()=>{
      const val = preset.value;
      // clear existing role fields
      rolesWrap.innerHTML = ''; roleCount = 0;
      addRole(); addRole();
      const fs = $$('#rolesWrap fieldset');
      if(val === '2pick1lift_2nd'){
        // Role1: Picker/Packer x2, 8h/day, 5d/wk, bill 22
        (function(r){
          $('select[name$="_roleSel"]',r).value='Picker/Packer';
          $('select[name$="_qty"]',r).value='2';
          $('select[name$="_hpdSel"]',r).value='8';
          $('select[name$="_dpwSel"]',r).value='5';
          $('select[name$="_mode"]',r).value='bill';
          $('input[name$="_bill"]',r).value='22';
        })(fs[0]);
        // Role2: Forklift x1, 8h/day, 5d/wk, bill 28
        (function(r){
          $('select[name$="_roleSel"]',r).value='Forklift Operator';
          $('select[name$="_qty"]',r).value='1';
          $('select[name$="_hpdSel"]',r).value='8';
          $('select[name$="_dpwSel"]',r).value='5';
          $('select[name$="_mode"]',r).value='bill';
          $('input[name$="_bill"]',r).value='28';
        })(fs[1]);
      } else if(val === '3prod_1qc'){
        (function(r){
          $('select[name$="_roleSel"]',r).value='Production Worker';
          $('select[name$="_qty"]',r).value='3';
          $('select[name$="_hpdSel"]',r).value='8';
          $('select[name$="_dpwSel"]',r).value='5';
          $('select[name$="_mode"]',r).value='bill';
          $('input[name$="_bill"]',r).value='23';
        })(fs[0]);
        (function(r){
          $('select[name$="_roleSel"]',r).value='Quality Control';
          $('select[name$="_qty"]',r).value='1';
          $('select[name$="_hpdSel"]',r).value='8';
          $('select[name$="_dpwSel"]',r).value='5';
          $('select[name$="_mode"]',r).value='bill';
          $('input[name$="_bill"]',r).value='26';
        })(fs[1]);
      } else if(val === '4pack_peak'){
        (function(r){
          $('select[name$="_roleSel"]',r).value='Picker/Packer';
          $('select[name$="_qty"]',r).value='4';
          $('select[name$="_hpdSel"]',r).value='10';
          $('select[name$="_dpwSel"]',r).value='6';
          $('select[name$="_mode"]',r).value='bill';
          $('input[name$="_bill"]',r).value='22';
        })(fs[0]);
        // Remove second default
        if(fs[1]) fs[1].remove(); roleCount = 1;
      }
    });

    // ===== Submit -> compute quotation -> PDF + email =====
    $('#quoteForm').addEventListener('submit', function(e){
      e.preventDefault();
      const { jsPDF } = window.jspdf || {};
      const data = Object.fromEntries(new FormData(e.target).entries());

      function pick(selectVal, otherVal){
        return selectVal === 'other' || selectVal === 'Other' ? otherVal : selectVal;
      }

      const currency = data.currency || 'USD';
      const weeks = Math.max(1, getNum(pick(data.weeks, data.weeks_other), 4));
      const discountPct = getNum(data.discountPct)/100;
      const otThreshold = Math.max(0, getNum(pick(data.otThreshold, data.otThreshold_other), 40));
      const otMult = Math.max(1, getNum(pick(data.otMult, data.otMult_other), 1.5));
      const wkndPremPct = getNum(pick(data.wkndPremPct, data.wkndPremPct_other))/100;
      const wkndHours = Math.max(0, getNum(pick(data.wkndHours, data.wkndHours_other), 0));

      // Roles
      const fsList = $$('#rolesWrap fieldset');
      const roles = [];
      fsList.forEach((fs, idx)=>{
        const roleSel = $('select[name$="_roleSel"]', fs).value;
        const roleOther = $('input[name$="_roleOther"]', fs).value;
        const role = roleSel==='Other' ? roleOther : roleSel;
        const qty = getNum($('select[name$="_qty"]', fs).value);
        const hpd = getNum(pick($('select[name$="_hpdSel"]', fs).value, $('input[name$="_hpdOther"]', fs).value));
        const dpw = getNum(pick($('select[name$="_dpwSel"]', fs).value, $('input[name$="_dpwOther"]', fs).value));
        const mode = $('select[name$="_mode"]', fs).value;
        let bill = getNum($('input[name$="_bill"]', fs).value);
        const pay = getNum($('input[name$="_pay"]', fs).value);
        const markup = getNum(pick($('select[name$="_markupSel"]', fs).value, $('input[name$="_markupOther"]', fs).value))/100;
        const fees = getNum(pick($('select[name$="_feesSel"]', fs).value, $('input[name$="_feesOther"]', fs).value));

        if(!role || qty<=0 || hpd<=0 || dpw<=0) return;
        if(mode==='markup' && pay>0){ bill = pay*(1+markup); }

        const weeklyBase = qty * hpd * dpw;
        const baseHours   = weeklyBase * weeks;
        const weeklyOT    = Math.max(0, weeklyBase - otThreshold);
        const otHours     = weeklyOT * weeks;
        const otCost      = otHours * bill * (otMult - 1);
        const wkndHrsTotal= qty * wkndHours * weeks;
        const wkndPremium = wkndHrsTotal * bill * wkndPremPct;
        const baseCost    = baseHours * bill;
        const total       = baseCost + otCost + wkndPremium + fees;

        roles.push({role, qty, hpd, dpw, weeks, bill, fees, baseHours, baseCost, otHours, otCost, wkndHrsTotal, wkndPremium, total});
      });

      const subtotal = roles.reduce((s,r)=>s+r.total, 0);
      const discount = subtotal * discountPct;
      const grand    = subtotal - discount;

      // Quote metadata
      const quoteId = 'ERE-' + Date.now().toString().slice(-8);
      const today = new Date();
      const validUntil = new Date(today.getTime() + 14*24*3600*1000);
      const fmtDate = (d)=> `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;

      // Email body
      const lines = [
        `Quote ID: ${quoteId}`,
        `Valid until: ${fmtDate(validUntil)}`,
        ``,
        `Company: ${data.company||''}`,
        `Primary Contact: ${data.name||''}`,
        `Email: ${data.email||''}`,
        `Phone/WhatsApp: ${data.phone||''}`,
        `Site Address: ${data.address||''}`,
        ``,
        `Currency: ${currency}`,
        `Duration (weeks): ${weeks}`,
        `OT rule: > ${otThreshold} hrs/week @ ${otMult}x`,
        `Weekend premium: ${(wkndPremPct*100).toFixed(1)}% on ${wkndHours} hrs/week/worker`,
        ``,
        `Roles:`
      ];
      roles.forEach(r=>{
        lines.push(`- ${r.role}: qty ${r.qty}, ${r.hpd}h/day, ${r.dpw}d/wk, bill ${fmt(r.bill,currency)} — total ${fmt(r.total,currency)}`);
      });
      lines.push(``,
        `Subtotal: ${fmt(subtotal,currency)}`,
        `Discount: -${fmt(discount,currency)}`,
        `Grand Total: ${fmt(grand,currency)}`,
        ``,
        `Other notes: ${data.notes||''}`
      );

      const subject = encodeURIComponent('Quotation Request');
      const body = encodeURIComponent(lines.join('\n'));

      // PDF
      const { jsPDF } = window.jspdf || {};
      if(jsPDF){
        const doc = new jsPDF();
        // Header band
        doc.setFillColor(244,246,248); doc.rect(0,0,210,28,'F');
        doc.setTextColor(31,45,58);
        doc.setFont('helvetica','bold'); doc.setFontSize(16);
        doc.text('eRe Staffing — Quotation', 14, 16);
        doc.setFontSize(10);
        doc.text(`Quote ID: ${quoteId}`, 14, 24);
        doc.text(`Valid until: ${fmtDate(validUntil)}`, 90, 24);
        doc.text(`Currency: ${currency}`, 160, 24);

        // Address block
        let y = 36;
        const hdr = (label, val) => { doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.text(label, 14, y); doc.setFont('helvetica','normal'); doc.setTextColor(62,76,89); doc.text(String(val||'—'), 60, y); doc.setTextColor(31,45,58); y += 7; };
        hdr('Company', data.company); hdr('Contact', data.name); hdr('Email', data.email); hdr('Phone', data.phone); hdr('Address', data.address);
        hdr('Duration (weeks)', weeks); hdr('OT rule', `>${otThreshold} hrs/wk @ ${otMult}x`); hdr('Weekend premium', `${(wkndPremPct*100).toFixed(1)}% on ${wkndHours} hrs/wk/worker`);

        y += 2; doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.text('Quotation Summary', 14, y); y += 6;
        doc.setFont('helvetica','bold'); doc.setFontSize(11);
        doc.text('Role',14,y); doc.text('Qty',70,y); doc.text('Hours',85,y); doc.text(`Bill ${currency==='EUR'?'€':'$'}/hr`,110,y); doc.text('Line Total',150,y);
        y += 5; doc.setDrawColor(200); doc.line(14,y,196,y); y += 6;

        doc.setFont('helvetica','normal'); doc.setTextColor(62,76,89);
        roles.forEach(r=>{
          const hours = r.baseHours + r.otHours + r.wkndHrsTotal;
          doc.text(String(r.role),14,y); doc.text(String(r.qty),70,y); doc.text(String(Math.round(hours)),85,y);
          doc.text(fmt(r.bill,currency),110,y); doc.text(fmt(r.total,currency),150,y);
          y += 6;
        });

        y += 4; doc.line(120,y,196,y); y += 6;
        doc.setFont('helvetica','bold'); doc.setTextColor(31,45,58);
        doc.text('Subtotal:',130,y); doc.text(fmt(subtotal,currency),170,y,{align:'right'});
        y += 6; doc.text(`Discount (${(discountPct*100).toFixed(1)}%):`,130,y); doc.text('-'+fmt(discount,currency),170,y,{align:'right'});
        y += 6; doc.text('Grand Total:',130,y); doc.text(fmt(grand,currency),170,y,{align:'right'});

        // Notes
        y += 10; doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.text('Notes & Assumptions',14,y); y += 6;
        doc.setFont('helvetica','normal'); doc.setFontSize(10);
        const notes = [
          'Rates include Employer-of-Record compliance (payroll, taxes, I-9).',
          'Standard overtime applies unless otherwise specified.',
          'Pricing valid through the date shown above and subject to worker availability.'
        ];
        notes.forEach(n=>{ const lines = doc.splitTextToSize(n, 180); doc.text(lines,14,y); y += lines.length*5; });

        // Signature lines
        y += 6; doc.setFont('helvetica','bold'); doc.setFontSize(12); doc.text('Approval',14,y); y += 10;
        doc.setDrawColor(120); doc.line(14,y,100,y); doc.text('Client Signature',14,y+6);
        doc.line(110,y,196,y); doc.text('Date',110,y+6);

        // Footer
        doc.setFontSize(9); doc.setTextColor(62,76,89);
        doc.text('eRe Staffing · erestaffing@gmail.com · WhatsApp: +49 1577 4010314', 14, 285-10);

        const fname = `quotation-${(data.company||'ere').replace(/[^a-z0-9-_ ]/gi,'').trim().replace(/\s+/g,'-')}.pdf`;
        doc.save(fname);
      }

      // Open email
      window.location.href = `mailto:erestaffing@gmail.com?subject=${encodeURIComponent('Quotation Request')}&body=${encodeURIComponent(lines.join('\n'))}`;
      $('#formNotice').textContent = 'Downloading your quotation PDF and opening your email draft…';
    });
  </script>
</body>
</html>
